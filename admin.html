<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Admin - 東京美食</title>
    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Tailwind CSS (現代化 UI 框架) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', 'Noto Sans TC', sans-serif; background-color: #f3f4f6; }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        /* 自定義捲軸 */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body>

<div id="app" class="h-screen flex flex-col overflow-hidden">

    <!-- 1. 登入/設定視窗 (Overlay) -->
    <div v-if="!isConfigured" class="fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden">
            <div class="bg-indigo-600 p-6 text-center">
                <i class="fas fa-server text-4xl text-white mb-2"></i>
                <h2 class="text-2xl font-bold text-white">連結 GitHub 資料庫</h2>
                <p class="text-indigo-200 text-sm mt-1">請輸入您的 Repository 資訊以管理菜單</p>
            </div>
            <div class="p-8 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">GitHub Personal Access Token</label>
                    <input type="password" v-model="config.token" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition" placeholder="ghp_xxxxxxxxxxxx">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">使用者名稱 (Owner)</label>
                        <input v-model="config.owner" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="e.g. yourname">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">倉庫名稱 (Repo)</label>
                        <input v-model="config.repo" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="e.g. tokyo-food">
                    </div>
                </div>
                <button @click="loadFromGithub" :disabled="loading" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 rounded-lg transition duration-200 flex justify-center items-center">
                    <i v-if="loading" class="fas fa-circle-notch fa-spin mr-2"></i>
                    {{ loading ? '連線中...' : '開始管理' }}
                </button>
            </div>
        </div>
    </div>

    <!-- 2. 主介面 (登入後顯示) -->
    <div v-else class="flex h-full">
        
        <!-- 左側導覽列 (餐廳列表) -->
        <aside class="w-64 bg-white border-r border-gray-200 flex flex-col shadow-sm z-10">
            <div class="p-5 border-b border-gray-100 flex items-center justify-between">
                <span class="font-bold text-gray-800 text-lg tracking-tight"><i class="fas fa-utensils text-indigo-500 mr-2"></i>餐廳列表</span>
                <button @click="addRestaurant" class="text-indigo-600 hover:bg-indigo-50 p-1 rounded-full transition" title="新增餐廳">
                    <i class="fas fa-plus-circle text-xl"></i>
                </button>
            </div>
            
            <div class="flex-1 overflow-y-auto p-3 space-y-1">
                <div v-for="(rest, idx) in data" :key="rest.id" 
                     @click="selectRestaurant(idx)"
                     class="group flex items-center p-3 rounded-lg cursor-pointer transition duration-200"
                     :class="currentRestIndex === idx ? 'bg-indigo-50 text-indigo-700 border-l-4 border-indigo-600 shadow-sm' : 'hover:bg-gray-50 text-gray-600 border-l-4 border-transparent'">
                    <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center mr-3 text-gray-500 group-hover:bg-white group-hover:text-indigo-500 transition">
                        <i class="fas fa-store"></i>
                    </div>
                    <div class="overflow-hidden">
                        <div class="font-medium truncate">{{ rest.name || '未命名餐廳' }}</div>
                        <div class="text-xs opacity-70 truncate">{{ rest.id }}</div>
                    </div>
                </div>
            </div>

            <!-- 底部操作區 -->
            <div class="p-4 border-t border-gray-200 bg-gray-50">
                <button @click="logout" class="text-sm text-gray-500 hover:text-red-600 flex items-center">
                    <i class="fas fa-sign-out-alt mr-2"></i> 登出 / 切換帳號
                </button>
            </div>
        </aside>

        <!-- 右側編輯區 -->
        <main class="flex-1 flex flex-col min-w-0 bg-gray-50">
            
            <!-- 頂部工具列 -->
            <header class="bg-white border-b border-gray-200 h-16 flex items-center justify-between px-6 shadow-sm z-10">
                <h1 v-if="currentRest" class="text-xl font-bold text-gray-800 truncate">
                    正在編輯: <span class="text-indigo-600">{{ currentRest.name }}</span>
                </h1>
                <h1 v-else class="text-xl text-gray-400">請選擇一間餐廳</h1>

                <div class="flex items-center space-x-3">
                    <span v-if="hasUnsavedChanges" class="text-amber-500 text-sm font-medium flex items-center animate-pulse">
                        <i class="fas fa-pen mr-1"></i> 未儲存變更
                    </span>
                    <a :href="`https://${config.owner}.github.io/${config.repo}/`" target="_blank" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm font-medium transition">
                        <i class="fas fa-external-link-alt mr-1"></i> 預覽前台
                    </a>
                    <button @click="saveToGithub" :disabled="saving" class="px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium shadow-md transition flex items-center">
                        <i v-if="saving" class="fas fa-circle-notch fa-spin mr-2"></i>
                        <i v-else class="fas fa-cloud-upload-alt mr-2"></i>
                        {{ saving ? '發布中...' : '發布更新' }}
                    </button>
                </div>
            </header>

            <!-- 內容編輯區 -->
            <div v-if="currentRest" class="flex-1 overflow-y-auto p-6">
                
                <!-- 頁籤切換 (基本資訊 vs 菜單內容) -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 mb-6 overflow-hidden">
                    <div class="flex border-b border-gray-200">
                        <button @click="activeTab = 'basic'" 
                                class="px-6 py-4 font-medium text-sm flex items-center transition relative"
                                :class="activeTab === 'basic' ? 'text-indigo-600 bg-indigo-50' : 'text-gray-500 hover:text-gray-700 hover:bg-gray-50'">
                            <i class="fas fa-info-circle mr-2"></i> 餐廳基本設定
                            <div v-if="activeTab === 'basic'" class="absolute bottom-0 left-0 w-full h-1 bg-indigo-600"></div>
                        </button>
                        <button @click="activeTab = 'menu'" 
                                class="px-6 py-4 font-medium text-sm flex items-center transition relative"
                                :class="activeTab === 'menu' ? 'text-indigo-600 bg-indigo-50' : 'text-gray-500 hover:text-gray-700 hover:bg-gray-50'">
                            <i class="fas fa-book-open mr-2"></i> 菜單內容編輯
                            <div v-if="activeTab === 'menu'" class="absolute bottom-0 left-0 w-full h-1 bg-indigo-600"></div>
                        </button>
                        <div class="flex-1"></div>
                        <button @click="deleteRestaurant" class="px-6 py-4 text-red-500 hover:text-red-700 text-sm font-medium hover:bg-red-50 transition">
                            <i class="fas fa-trash-alt mr-1"></i> 刪除餐廳
                        </button>
                    </div>

                    <!-- TAB 1: 基本資訊 -->
                    <div v-if="activeTab === 'basic'" class="p-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">餐廳 ID (系統用，英文)</label>
                            <input v-model="currentRest.id" class="form-input">
                        </div>
                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">顯示名稱 (中文)</label>
                            <input v-model="currentRest.name" class="form-input text-lg font-bold">
                        </div>
                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">副標題 (日文/英文)</label>
                            <input v-model="currentRest.subName" class="form-input">
                        </div>
                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">標籤資訊 (如：午間套餐價格)</label>
                            <div class="flex items-center">
                                <input v-model="currentRest.heroInfo" class="form-input rounded-r-none">
                                <span class="bg-gray-100 border border-l-0 border-gray-300 px-3 py-2 rounded-r-lg text-gray-500 text-sm">預覽</span>
                            </div>
                        </div>
                    </div>

                    <!-- TAB 2: 菜單編輯 -->
                    <div v-if="activeTab === 'menu'" class="p-6 bg-gray-50 min-h-[500px]">
                        
                        <!-- 1. 菜單分頁選擇器 (Tabs) -->
                        <div class="flex items-center space-x-2 mb-6 overflow-x-auto pb-2">
                            <span class="text-sm font-bold text-gray-500 uppercase mr-2 flex-shrink-0">菜單分頁:</span>
                            <div v-for="(tab, tIdx) in currentRest.tabs" :key="tIdx" 
                                 @click="currentMenuTabIdx = tIdx"
                                 class="cursor-pointer px-4 py-2 rounded-full text-sm font-medium transition flex items-center flex-shrink-0"
                                 :class="currentMenuTabIdx === tIdx ? 'bg-white text-indigo-700 shadow ring-1 ring-indigo-200' : 'bg-gray-200 text-gray-600 hover:bg-gray-300'">
                                <span v-if="currentMenuTabIdx !== tIdx">{{ tab.name }}</span>
                                <input v-else v-model="tab.name" class="bg-transparent outline-none w-20 text-center border-b border-indigo-300" @click.stop>
                                <button v-if="currentRest.tabs.length > 1" @click.stop="removeTab(tIdx)" class="ml-2 text-gray-400 hover:text-red-500">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <button @click="addTab" class="flex-shrink-0 w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 hover:bg-indigo-200 flex items-center justify-center transition">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>

                        <!-- 2. 分類與菜色編輯器 -->
                        <div v-if="currentMenuTab" class="space-y-6">
                            
                            <!-- 分類區塊 Loop -->
                            <div v-for="(section, sIdx) in currentMenuTab.sections" :key="sIdx" 
                                 class="bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden transition hover:shadow-md">
                                
                                <!-- 分類標題列 -->
                                <div class="bg-gray-50 px-4 py-3 border-b border-gray-200 flex items-center justify-between">
                                    <div class="flex items-center flex-1">
                                        <div class="flex flex-col space-y-1">
                                            <button @click="moveSection(sIdx, -1)" :disabled="sIdx===0" class="text-gray-400 hover:text-indigo-600 disabled:opacity-30"><i class="fas fa-chevron-up"></i></button>
                                            <button @click="moveSection(sIdx, 1)" :disabled="sIdx===currentMenuTab.sections.length-1" class="text-gray-400 hover:text-indigo-600 disabled:opacity-30"><i class="fas fa-chevron-down"></i></button>
                                        </div>
                                        <div class="ml-3 flex-1">
                                            <input v-model="section.name" class="w-full bg-transparent font-bold text-gray-700 text-lg outline-none placeholder-gray-400" placeholder="分類名稱 (如：開胃菜)">
                                        </div>
                                    </div>
                                    <button @click="removeSection(sIdx)" class="text-gray-400 hover:text-red-500 ml-4 p-2 transition">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>

                                <!-- 菜色列表 -->
                                <div class="p-4 space-y-3">
                                    <div v-for="(item, iIdx) in section.items" :key="iIdx" class="flex items-start bg-white p-3 rounded border border-gray-100 hover:border-indigo-100 hover:bg-indigo-50/30 transition group">
                                        <!-- 排序把手 -->
                                        <div class="flex flex-col mr-3 pt-1 text-gray-300">
                                            <button @click="moveItem(section, iIdx, -1)" class="hover:text-indigo-500"><i class="fas fa-caret-up"></i></button>
                                            <button @click="moveItem(section, iIdx, 1)" class="hover:text-indigo-500"><i class="fas fa-caret-down"></i></button>
                                        </div>

                                        <!-- 內容輸入 -->
                                        <div class="flex-1 grid grid-cols-12 gap-3">
                                            <div class="col-span-4">
                                                <label class="text-xs text-gray-400 block mb-1">中文名稱</label>
                                                <input v-model="item.name" class="w-full text-sm font-medium border-b border-gray-200 bg-transparent focus:border-indigo-500 outline-none pb-1" placeholder="菜名">
                                            </div>
                                            <div class="col-span-4">
                                                <label class="text-xs text-gray-400 block mb-1">原文/英文</label>
                                                <input v-model="item.subName" class="w-full text-sm text-gray-500 border-b border-gray-200 bg-transparent focus:border-indigo-500 outline-none pb-1" placeholder="原文">
                                            </div>
                                            <div class="col-span-2">
                                                <label class="text-xs text-gray-400 block mb-1">價格</label>
                                                <input v-model.number="item.price" type="number" class="w-full text-sm font-bold text-gray-700 border-b border-gray-200 bg-transparent focus:border-indigo-500 outline-none pb-1">
                                            </div>
                                            <div class="col-span-2 flex items-center justify-end space-x-2 pt-4">
                                                <label class="cursor-pointer flex items-center text-xs text-gray-500 hover:text-indigo-600">
                                                    <input type="checkbox" v-model="item.isPlus" class="mr-1 accent-indigo-600">
                                                    加價購
                                                </label>
                                                <button @click="removeItem(section, iIdx)" class="text-gray-300 hover:text-red-500 transition px-2">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                            
                                            <!-- 第二行：描述與選項 -->
                                            <div class="col-span-12 mt-2 pt-2 border-t border-dashed border-gray-100 flex items-start">
                                                <div class="flex-1 mr-4">
                                                    <input v-model="item.desc" class="w-full text-xs text-gray-500 bg-transparent outline-none placeholder-gray-300" placeholder="餐點描述 (例如：附薯條、含花生)">
                                                </div>
                                                
                                                <!-- 選項管理 -->
                                                <div class="flex flex-wrap items-center gap-2">
                                                    <div v-for="(opt, oIdx) in item.options" :key="oIdx" 
                                                         class="flex items-center bg-white border border-gray-200 rounded px-2 py-1 text-xs shadow-sm">
                                                        <span>{{ opt.name }}</span>
                                                        <span class="text-indigo-600 ml-1 font-bold">{{ opt.price }}</span>
                                                        <button @click="item.options.splice(oIdx, 1)" class="ml-2 text-gray-300 hover:text-red-500"><i class="fas fa-times"></i></button>
                                                    </div>
                                                    <button @click="addOption(item)" class="text-xs text-indigo-500 hover:text-indigo-700 font-medium px-2 py-1 bg-indigo-50 rounded hover:bg-indigo-100 transition">
                                                        <i class="fas fa-plus mr-1"></i>選項
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <button @click="addItem(section)" class="w-full py-2 border-2 border-dashed border-gray-200 rounded-lg text-gray-400 hover:border-indigo-300 hover:text-indigo-500 hover:bg-indigo-50 transition text-sm font-medium">
                                        <i class="fas fa-plus mr-1"></i> 新增一道菜
                                    </button>
                                </div>
                            </div>

                            <button @click="addSection" class="w-full py-4 bg-white border border-gray-200 shadow-sm rounded-xl text-gray-500 hover:text-indigo-600 hover:shadow-md transition font-medium">
                                <i class="fas fa-folder-plus mr-2"></i> 新增一個分類區塊 (如: 甜點區)
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div v-else class="flex-1 flex flex-col items-center justify-center text-gray-400">
                <i class="fas fa-utensils text-6xl mb-4 text-gray-200"></i>
                <p>請從左側選擇餐廳開始編輯，或新增一間餐廳。</p>
            </div>
        </main>
    </div>

    <!-- Toast 通知 (右上角) -->
    <transition name="fade">
        <div v-if="toast.show" class="fixed top-5 right-5 z-50 px-6 py-4 rounded-lg shadow-lg text-white font-medium flex items-center" :class="toast.type === 'error' ? 'bg-red-500' : 'bg-green-500'">
            <i class="fas mr-3" :class="toast.type === 'error' ? 'fa-exclamation-circle' : 'fa-check-circle'"></i>
            {{ toast.message }}
        </div>
    </transition>

</div>

<script>
    const { createApp, reactive, ref, computed, watch } = Vue;

    createApp({
        setup() {
            // 狀態變數
            const config = reactive({
                token: localStorage.getItem('gh_token') || '',
                owner: localStorage.getItem('gh_owner') || '',
                repo: localStorage.getItem('gh_repo') || '',
                path: 'data.json'
            });

            const isConfigured = computed(() => !!(localStorage.getItem('gh_token'))); // 簡單判斷是否已設定
            const data = ref([]);
            const currentRestIndex = ref(0);
            const currentMenuTabIdx = ref(0);
            const activeTab = ref('basic'); // 'basic' or 'menu'
            const sha = ref('');
            
            const loading = ref(false);
            const saving = ref(false);
            const hasUnsavedChanges = ref(false);
            
            const toast = reactive({ show: false, message: '', type: 'success' });

            const currentRest = computed(() => data.value[currentRestIndex.value]);
            const currentMenuTab = computed(() => currentRest.value?.tabs[currentMenuTabIdx.value]);

            // --- 方法 ---

            const showToast = (msg, type = 'success') => {
                toast.message = msg;
                toast.type = type;
                toast.show = true;
                setTimeout(() => toast.show = false, 3000);
            };

            const logout = () => {
                if(confirm('確定要登出並清除設定嗎？')) {
                    localStorage.removeItem('gh_token');
                    location.reload();
                }
            };

            // GitHub API 讀取
            const loadFromGithub = async () => {
                if(!config.token || !config.owner || !config.repo) {
                    showToast('請填寫完整資訊', 'error');
                    return;
                }
                
                loading.value = true;
                try {
                    const url = `https://api.github.com/repos/${config.owner}/${config.repo}/contents/${config.path}`;
                    const res = await fetch(url, { headers: { 'Authorization': `token ${config.token}` } });
                    
                    if (!res.ok) throw new Error('連線失敗，請檢查 Token 與 Repo 名稱');
                    
                    const json = await res.json();
                    sha.value = json.sha;
                    // 解碼 Base64 (支援 UTF-8)
                    const content = new TextDecoder().decode(Uint8Array.from(atob(json.content), c => c.charCodeAt(0)));
                    
                    data.value = JSON.parse(content);
                    
                    // 儲存設定
                    localStorage.setItem('gh_token', config.token);
                    localStorage.setItem('gh_owner', config.owner);
                    localStorage.setItem('gh_repo', config.repo);
                    
                    showToast('資料讀取成功');
                } catch (e) {
                    console.error(e);
                    // 失敗或是第一次使用
                    if(e.message.includes('404')) {
                        if(confirm('找不到 data.json，要初始化一個新的嗎？')) {
                             data.value = [];
                             localStorage.setItem('gh_token', config.token);
                             localStorage.setItem('gh_owner', config.owner);
                             localStorage.setItem('gh_repo', config.repo);
                             addRestaurant(); // 加一個預設的
                        }
                    } else {
                        showToast(e.message, 'error');
                    }
                } finally {
                    loading.value = false;
                }
            };

            // GitHub API 儲存
            const saveToGithub = async () => {
                saving.value = true;
                try {
                    const jsonString = JSON.stringify(data.value, null, 2);
                    // 編碼 UTF-8 to Base64
                    const contentBase64 = btoa(String.fromCharCode(...new TextEncoder().encode(jsonString)));
                    
                    const url = `https://api.github.com/repos/${config.owner}/${config.repo}/contents/${config.path}`;
                    
                    const body = {
                        message: "Update menu via Admin Panel " + new Date().toLocaleString(),
                        content: contentBase64,
                        sha: sha.value
                    };

                    const res = await fetch(url, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${config.token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(body)
                    });

                    if (!res.ok) throw new Error('儲存失敗');
                    
                    const result = await res.json();
                    sha.value = result.content.sha;
                    hasUnsavedChanges.value = false;
                    showToast('發布成功！手機重新整理即可看到。');
                } catch (e) {
                    showToast(e.message, 'error');
                } finally {
                    saving.value = false;
                }
            };

            // --- 編輯操作邏輯 ---

            const selectRestaurant = (idx) => {
                currentRestIndex.value = idx;
                currentMenuTabIdx.value = 0;
                activeTab.value = 'basic';
            };

            const addRestaurant = () => {
                data.value.push({
                    id: 'new-rest-' + Date.now(),
                    name: '新餐廳',
                    subName: '',
                    heroInfo: '',
                    tabs: [ { id: 'main', name: '主菜單', sections: [] } ]
                });
                selectRestaurant(data.value.length - 1);
            };

            const deleteRestaurant = () => {
                if(confirm(`確定要刪除「${currentRest.value.name}」嗎？此動作無法復原。`)) {
                    data.value.splice(currentRestIndex.value, 1);
                    if(data.value.length > 0) selectRestaurant(0);
                    else currentRestIndex.value = -1;
                }
            };

            // Tabs 操作
            const addTab = () => {
                currentRest.value.tabs.push({ id: 'tab-'+Date.now(), name: '新分頁', sections: [] });
                currentMenuTabIdx.value = currentRest.value.tabs.length - 1;
            };
            const removeTab = (idx) => {
                if(confirm('確定刪除此分頁？')) {
                    currentRest.value.tabs.splice(idx, 1);
                    currentMenuTabIdx.value = 0;
                }
            };

            // Section 操作
            const addSection = () => {
                currentMenuTab.value.sections.push({ name: '新分類', items: [] });
            };
            const removeSection = (idx) => {
                if(confirm('刪除此分類與其下所有菜色？')) {
                    currentMenuTab.value.sections.splice(idx, 1);
                }
            };
            const moveSection = (idx, direction) => {
                const arr = currentMenuTab.value.sections;
                const newIdx = idx + direction;
                if (newIdx >= 0 && newIdx < arr.length) {
                    [arr[idx], arr[newIdx]] = [arr[newIdx], arr[idx]];
                }
            };

            // Item 操作
            const addItem = (section) => {
                section.items.push({ name: '', subName: '', price: 0, desc: '', options: [] });
            };
            const removeItem = (section, idx) => {
                section.items.splice(idx, 1);
            };
            const moveItem = (section, idx, direction) => {
                const arr = section.items;
                const newIdx = idx + direction;
                if (newIdx >= 0 && newIdx < arr.length) {
                    [arr[idx], arr[newIdx]] = [arr[newIdx], arr[idx]];
                }
            };

            // Option 操作
            const addOption = (item) => {
                const name = prompt("輸入選項名稱 (如: 培根)");
                if(!name) return;
                const price = prompt("輸入價格 (如: +300)", "+0");
                if(!item.options) item.options = [];
                item.options.push({ name, price });
            };

            // 監聽數據變更
            watch(data, () => {
                if(sha.value) hasUnsavedChanges.value = true;
            }, { deep: true });

            // 初始自動讀取 (如果已登入)
            if(isConfigured.value) {
                setTimeout(loadFromGithub, 500);
            }

            return {
                config, isConfigured, loading, saving, data, 
                currentRest, currentRestIndex, currentMenuTab, currentMenuTabIdx, activeTab,
                hasUnsavedChanges, toast,
                logout, loadFromGithub, saveToGithub,
                selectRestaurant, addRestaurant, deleteRestaurant,
                addTab, removeTab,
                addSection, removeSection, moveSection,
                addItem, removeItem, moveItem,
                addOption
            };
        }
    }).mount('#app');
</script>

<style>
    /* CSS Helper for input style */
    .form-input {
        width: 100%;
        padding: 0.5rem 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
        outline: none;
        transition: border-color 0.2s;
    }
    .form-input:focus {
        border-color: #4f46e5;
        box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.1);
    }
</style>
</body>
</html>
